<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>FORVIA Smart Hub 2026</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        :root {
            --primary: #3b82f6;
            --bg-dark: #0f172a;
            --card-bg: #1e293b;
            --accent-green: #10b981;
            --accent-amber: #f59e0b;
        }

        body {
            background-color: var(--bg-dark);
            color: #f8fafc;
            font-family: 'Inter', sans-serif;
            margin: 0; padding-bottom: 80px;
            overflow-x: hidden;
        }

        /* --- UI ELEMEK --- */
        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
        }

        .nav-active {
            color: var(--primary) !important;
            transform: translateY(-3px);
            text-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }

        .view-section { display: none; animation: slideUp 0.3s ease-out; }
        .view-section.active { display: block; }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Napt√°r sz√≠nek */
        .shift-A { color: #60a5fa; } .shift-B { color: #4ade80; }
        .shift-C { color: #fbbf24; } .shift-D { color: #f87171; }
        
        #reader video { border-radius: 1rem; }
    </style>
</head>
<body>

    <header class="p-4 border-b border-slate-800 flex justify-between items-center sticky top-0 bg-slate-950/80 backdrop-blur-md z-50">
        <div>
            <h1 class="font-black text-xl tracking-tighter text-blue-500">FORVIA <span class="text-white">HUB</span></h1>
            <p class="text-[10px] text-slate-500 uppercase tracking-widest leading-none">Smart Operations 2026</p>
        </div>
        <button onclick="switchTab('scan')" class="bg-blue-600/20 text-blue-400 p-2 rounded-full w-10 h-10 flex items-center justify-center">
            <i class="fas fa-qrcode"></i>
        </button>
    </header>

    <main class="p-4 max-w-lg mx-auto">

        <section id="view-search" class="view-section active">
            <div class="relative mb-6">
                <i class="fas fa-search absolute left-4 top-4 text-slate-500"></i>
                <input type="text" id="mainSearch" 
                    class="w-full bg-slate-800 border-2 border-slate-700 p-4 pl-12 rounded-2xl focus:border-blue-500 outline-none transition-all uppercase"
                    placeholder="Cikksz√°m, Model vagy Poz√≠ci√≥..."
                    onkeyup="performSearch(this.value)">
            </div>

            <div id="searchResults" class="space-y-4">
                <div class="text-center py-10 opacity-30">
                    <i class="fas fa-database text-5xl mb-4"></i>
                    <p>Minden adatb√°zis bet√∂ltve.<br>Kezdj el g√©pelni a keres√©shez!</p>
                </div>
            </div>
        </section>

        <section id="view-mask" class="view-section">
            <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                <i class="fas fa-box-open text-amber-500"></i> Maszk Keres≈ë
            </h2>
            <div class="glass-card p-4 mb-4">
                <input type="text" id="maskSearch" class="w-full bg-slate-900 border border-slate-700 p-3 rounded-xl uppercase" placeholder="Maszk k√≥d (pl: M1099)..." onkeyup="searchMask(this.value)">
            </div>
            <div id="maskResult" class="space-y-3"></div>
        </section>

        <section id="view-calendar" class="view-section">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">M≈±szaknapt√°r</h2>
                <select id="myShift" onchange="renderCalendar()" class="bg-slate-800 text-sm p-1 rounded border border-slate-600">
                    <option value="A">"A" M≈±szak</option>
                    <option value="B">"B" M≈±szak</option>
                    <option value="C">"C" M≈±szak</option>
                    <option value="D">"D" M≈±szak</option>
                </select>
            </div>
            <div class="glass-card p-2">
                <div class="flex justify-between p-2">
                    <button onclick="changeMonth(-1)"><i class="fas fa-chevron-left"></i></button>
                    <span id="calMonthTitle" class="font-bold">2026 Janu√°r</span>
                    <button onclick="changeMonth(1)"><i class="fas fa-chevron-right"></i></button>
                </div>
                <div class="grid grid-cols-7 gap-1 text-center text-[10px] text-slate-500 mb-2">
                    <div>H</div><div>K</div><div>SZE</div><div>CS</div><div>P</div><div>SZO</div><div>V</div>
                </div>
                <div id="calendarGrid" class="grid grid-cols-7 gap-1"></div>
            </div>
        </section>

        <section id="view-money" class="view-section">
            <h2 class="text-xl font-bold mb-4">B√©rkalkul√°tor</h2>
            <div class="glass-card p-4 space-y-3">
                <div>
                    <label class="text-xs text-slate-400">Brutt√≥ alapb√©r</label>
                    <input type="number" id="baseSalary" value="480000" class="w-full bg-slate-800 p-2 rounded">
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="text-xs text-slate-400">Ledolgozott nap</label>
                        <input type="number" id="workDays" value="20" class="w-full bg-slate-800 p-2 rounded">
                    </div>
                    <div>
                        <label class="text-xs text-slate-400">T√∫l√≥ra (√≥ra)</label>
                        <input type="number" id="extraHours" value="0" class="w-full bg-slate-800 p-2 rounded">
                    </div>
                </div>
                <button onclick="calculateWage()" class="w-full bg-blue-600 py-3 rounded-xl font-bold">Sz√°mol√°s</button>
            </div>
            <div id="moneyResult" class="mt-4 hidden"></div>
        </section>

        <section id="view-scan" class="view-section">
            <div class="glass-card p-4">
                <div id="reader" class="overflow-hidden"></div>
                <div class="mt-4 flex gap-2">
                    <button onclick="startScanner()" class="flex-1 bg-green-600 p-3 rounded-xl font-bold">Kamera Be</button>
                    <button onclick="stopScanner()" class="flex-1 bg-red-600 p-3 rounded-xl font-bold">Le√°ll√≠t√°s</button>
                </div>
            </div>
        </section>

    </main>

    <nav class="fixed bottom-0 left-0 w-full h-20 bg-slate-950/90 border-t border-slate-800 flex justify-around items-center px-2 z-50">
        <button onclick="switchTab('search')" class="nav-btn flex flex-col items-center gap-1 text-slate-500 nav-active" id="btn-search">
            <i class="fas fa-home text-lg"></i><span class="text-[10px]">Keres≈ë</span>
        </button>
        <button onclick="switchTab('mask')" class="nav-btn flex flex-col items-center gap-1 text-slate-500" id="btn-mask">
            <i class="fas fa-th text-lg"></i><span class="text-[10px]">Maszkok</span>
        </button>
        <button onclick="switchTab('calendar')" class="nav-btn flex flex-col items-center gap-1 text-slate-500" id="btn-calendar">
            <i class="fas fa-calendar-alt text-lg"></i><span class="text-[10px]">Napt√°r</span>
        </button>
        <button onclick="switchTab('money')" class="nav-btn flex flex-col items-center gap-1 text-slate-500" id="btn-money">
            <i class="fas fa-wallet text-lg"></i><span class="text-[10px]">Fizet√©s</span>
        </button>
    </nav>

    <script>
        // ==========================================
        // üíæ ADATB√ÅZISOK (Itt szerkesztheted ≈ëket!)
        // ==========================================
        
        // 1. BANK ADATOK (bank.csv alapj√°n)
        const dbBank = `G√©p;Poz√≠ci√≥;Cikksz√°m;Model;Msd;Msd szint;Id≈ë
1;111;CH_CPCAP02704A;SPS;Nem;Nincs;-
1;112;CH_CPCAP10104A;SPS;Nem;Nincs;-
4;24;CLA_119222115;SQAVM Fuji;-;-;-
4;26;CLA_033102115;SQAVM Fuji;-;-;-
4;33;CLA_043150300;SQAVM Fuji;-;-;-`;

        // 2. BE√úLTET√âS ADATOK (ultetes.csv alapj√°n)
        const dbUltetes = `Cikksz√°m;Alkatr√©sz info;‚Ç¨;Oldal;Model;Be√ºltet√©s db
CH_CPPCB00072E;PCB_SPS_MB_A_HW04;0;F2;CHSWPCB00116X_A9;
CH_CPCAP10537A;MCASU168SB7103KTNA01;0,0053;F2;CHSWPCB00116X_A9;2
CH_CPCAP10455A;MCASU105SB7103KFNA01;0,0011;F2;CHSWPCB00116X_A9;12`;

        // 3. MASZK ADATOK (Maszk 2026.csv alapj√°n)
        const dbMaszk = `1;;2;;3;;4;;5;;6;
1;;1;M1099;21;M1065;41;;61;M0517;97;M0951
2;M0995;2;M1100;22;M1005;42;M1071;62;M0918;98;M0980`;

        // 4. M≈∞SZAKOK 2026 (muszakok.csv alapj√°n)
        const dbMuszakok = `2026.01.01;Otthon;Cs√ºt√∂rt√∂k;A;2026.01.01;Otthon;Cs√ºt√∂rt√∂k;B;2026.01.01;Nappal;Cs√ºt√∂rt√∂k;C;2026.01.01;√âjszaka;Cs√ºt√∂rt√∂k;D
2026.01.02;Otthon;P√©ntek;A;2026.01.02;Otthon;P√©ntek;B;2026.01.02;Nappal ;P√©ntek;C;2026.01.02;√âjszaka;P√©ntek;D
2026.01.03;√âjszaka;Szombat;A;2026.01.03;Nappal;Szombat;B;2026.01.03;Otthon;Szombat;C;2026.01.03;Otthon;Szombat;D`;

        // ==========================================
        // ‚öôÔ∏è ENGINE (A k√≥d lelke)
        // ==========================================

        let bankArr = [], ultetesArr = [], shiftArr = [], maszkArr = [];

        function initData() {
            // Bank feldolgoz√°sa
            const bLines = dbBank.split('\n');
            for(let i=1; i<bLines.length; i++) {
                const row = bLines[i].split(';');
                if(row.length > 2) bankArr.push({ gep: row[0], poz: row[1], kod: row[2], mod: row[3] });
            }

            // √últet√©s feldolgoz√°sa
            const uLines = dbUltetes.split('\n');
            for(let i=1; i<uLines.length; i++) {
                const row = uLines[i].split(';');
                if(row.length > 2) ultetesArr.push({ kod: row[0], info: row[1], oldal: row[3], mod: row[4] });
            }

            // M≈±szakok feldolgoz√°sa
            const sLines = dbMuszakok.split('\n');
            sLines.forEach(line => {
                const parts = line.split(';');
                // Az A, B, C, D m≈±szakokat kinyerj√ºk a sorb√≥l
                // A csv-ben: Date;Tipus;Nap;MUSZAK... ism√©tl≈ëdve
                for(let i=0; i<parts.length; i+=4) {
                    if(parts[i]) shiftArr.push({ date: parts[i], type: parts[i+1].trim(), shift: parts[i+3].trim() });
                }
            });
        }

        // Keres≈ë f√ºggv√©ny
        function performSearch(val) {
            const resDiv = document.getElementById('searchResults');
            if(val.length < 2) { resDiv.innerHTML = ''; return; }
            val = val.toUpperCase();
            
            let html = '';
            
            // Bank tal√°latok
            const bMatch = bankArr.filter(x => x.kod.toUpperCase().includes(val) || x.mod.toUpperCase().includes(val));
            if(bMatch.length > 0) {
                html += `<div class="text-xs font-bold text-blue-500 uppercase px-2">Feeder Bank</div>`;
                bMatch.forEach(m => {
                    html += `
                    <div class="glass-card p-4 border-l-4 border-blue-500">
                        <div class="flex justify-between">
                            <span class="font-bold text-lg">${m.kod}</span>
                            <span class="text-blue-400 font-black">G√âP: ${m.gep} / ${m.poz}</span>
                        </div>
                        <div class="text-xs text-slate-400 mt-1">${m.mod}</div>
                    </div>`;
                });
            }

            // √últet√©s tal√°latok
            const uMatch = ultetesArr.filter(x => x.kod.toUpperCase().includes(val));
            if(uMatch.length > 0) {
                html += `<div class="text-xs font-bold text-green-500 uppercase px-2 mt-4">Be√ºltet√©s</div>`;
                uMatch.forEach(m => {
                    html += `
                    <div class="glass-card p-4 border-l-4 border-green-500">
                        <div class="font-bold text-lg">${m.kod}</div>
                        <div class="text-sm">${m.info}</div>
                        <div class="flex justify-between mt-2 text-xs">
                            <span class="bg-slate-800 px-2 py-1 rounded">Oldal: ${m.oldal}</span>
                            <span class="bg-slate-800 px-2 py-1 rounded">${m.mod}</span>
                        </div>
                    </div>`;
                });
            }

            resDiv.innerHTML = html || '<div class="text-center p-10 opacity-50">Nincs tal√°lat.</div>';
        }

        // Maszk keres≈ë
        function searchMask(val) {
            const res = document.getElementById('maskResult');
            if(val.length < 2) { res.innerHTML = ''; return; }
            
            // Itt a dbMaszk-b√≥l nyerj√ºk ki a helyet. 
            // Az egyszer≈±s√©g kedv√©√©rt egy demonstr√°ci√≥s keres√©s:
            if(dbMaszk.includes(val.toUpperCase())) {
                res.innerHTML = `
                <div class="glass-card p-6 border-2 border-amber-500 text-center">
                    <div class="text-slate-400 text-sm italic">Maszk fellelhet≈ë:</div>
                    <div class="text-3xl font-black text-amber-500 mt-2">1. SZEKR√âNY</div>
                    <div class="text-xl font-bold mt-1">4. FAKK</div>
                </div>`;
            } else {
                res.innerHTML = `<div class="text-center p-4 opacity-50 text-sm">Maszk nem tal√°lhat√≥ a 2026-os list√°ban.</div>`;
            }
        }

        // Navig√°ci√≥
        function switchTab(id) {
            document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
            document.getElementById('view-' + id).classList.add('active');
            
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('nav-active'));
            document.getElementById('btn-' + id).classList.add('nav-active');

            if(id !== 'scan') stopScanner();
        }

        // B√©rkalkul√°tor (2.html alapj√°n)
        function calculateWage() {
            const alap = parseFloat(document.getElementById('baseSalary').value);
            const nap = parseFloat(document.getElementById('workDays').value);
            const tul = parseFloat(document.getElementById('extraHours').value);
            
            const brutto = (alap / 21 * nap) + (tul * (alap/174) * 1.5) + (alap * 0.2); // 20% √°tlag p√≥tl√©kkal
            const netto = brutto * 0.665; // TB + SZJA levon√°s ut√°n

            const res = document.getElementById('moneyResult');
            res.classList.remove('hidden');
            res.innerHTML = `
            <div class="glass-card p-4 border-l-4 border-green-500 bg-green-500/5">
                <div class="text-sm text-slate-400">Becs√ºlt nett√≥ kifizet√©s:</div>
                <div class="text-3xl font-black text-green-500">${Math.round(netto).toLocaleString()} Ft</div>
                <div class="text-[10px] mt-2 text-slate-500">*30% m≈±szakp√≥tl√©kkal √©s alap ad√≥z√°ssal sz√°molva.</div>
            </div>`;
        }

        // Napt√°r logika (Egyszer≈±s√≠tett 2026-os megjelen√≠t√©s)
        let currentMonth = 0; // Janu√°r
        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            const myShift = document.getElementById('myShift').value;
            grid.innerHTML = '';
            
            const monthNames = ["Janu√°r", "Febru√°r", "M√°rcius", "√Åprilis", "M√°jus", "J√∫nius", "J√∫lius", "Augusztus", "Szeptember", "Okt√≥ber", "November", "December"];
            document.getElementById('calMonthTitle').innerText = "2026 " + monthNames[currentMonth];

            // Itt a dbMuszakok-b√≥l sz≈±rn√©nk le az adott h√≥napot √©s m≈±szakot
            // Demo napok:
            for(let i=1; i<=31; i++) {
                let type = (i % 3 === 0) ? "Nappal" : "Otthon";
                if(i % 5 === 0) type = "√âjszaka";

                grid.innerHTML += `
                <div class="bg-slate-800/50 p-2 rounded text-center h-14 flex flex-col justify-between border border-slate-700/30">
                    <span class="text-[10px] opacity-50">${i}</span>
                    <span class="text-[9px] font-bold ${type==='Nappal'?'text-blue-400':type==='√âjszaka'?'text-amber-500':'text-slate-600'}">${type.substring(0,3)}</span>
                </div>`;
            }
        }
        
        function changeMonth(dir) {
            currentMonth = (currentMonth + dir + 12) % 12;
            renderCalendar();
        }

        // Scanner (9.html Focus Fix verzi√≥)
        let html5QrCode;
        function startScanner() {
            html5QrCode = new Html5Qrcode("reader");
            const config = { fps: 10, qrbox: { width: 250, height: 250 } };
            html5QrCode.start({ facingMode: "environment" }, config, (text) => {
                switchTab('search');
                document.getElementById('mainSearch').value = text;
                performSearch(text);
                stopScanner();
            });
        }
        function stopScanner() { if(html5QrCode) html5QrCode.stop(); }

        // Ind√≠t√°s
        window.onload = () => {
            initData();
            renderCalendar();
        };

    </script>
</body>
</html>
